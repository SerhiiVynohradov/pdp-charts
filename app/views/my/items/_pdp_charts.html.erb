<div class="mb-8">
  <h2 class="text-xl font-bold mb-2">My PDP Quarterly Chart</h2>
  <div id="pdpChartContainer" style="height: 600px; width: 100%;"></div>
</div>

<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  // Raw JSON data from Ruby
  const waRaw     = <%= raw(@chart_data[:wa_data].to_json) %>
  const effortRaw = <%= raw(@chart_data[:effort_data].to_json) %>
  const itemsRaw  = <%= raw(@chart_data[:items_data].to_json) %>

  // Convert string date -> new Date
  const waData = waRaw.map(pt => ({ x: new Date(pt.x), y: pt.y }))
  const effortData = effortRaw.map(pt => ({ x: new Date(pt.x), y: pt.y }))
  const itemsData = itemsRaw.map(pt => ({ x: new Date(pt.x), y: pt.y }))

  // We create a StockChart with 2 "charts":
  // 1) The main chart (top) showing WA (left axis) & Effort (right axis).
  // 2) A secondary chart (below) showing # Items on a single axis.

  const stockChart = new CanvasJS.StockChart("pdpChartContainer", {
    theme: "dark2",
    backgroundColor: "#1f2937", // dark binance-like background
    title: {
      text: "My PDP (WA & Effort on Main Chart, # Items below)"
    },

    charts: [
      // MAIN CHART (WA vs. Effort)
      {
        height: 300,  // or any value that suits your layout
        axisY: {
          title: "Weighted Average",
          titleFontColor: "#66bb6a",
          labelFontColor: "#66bb6a",
          minimum: 0
        },
        axisY2: {
          title: "Effort",
          titleFontColor: "#ff9800",
          labelFontColor: "#ff9800",
          minimum: 0
        },
        data: [
          {
            type: "line",
            name: "WA",
            axisYType: "primary",    // left axis
            color: "#66bb6a",
            lineThickness: 3,
            markerSize: 5,
            showInLegend: true,
            dataPoints: waData
          },
          {
            type: "line",
            name: "Effort",
            axisYType: "secondary", // right axis
            color: "#ff9800",
            lineThickness: 3,
            markerSize: 5,
            showInLegend: true,
            dataPoints: effortData
          }
        ]
      },

      // SECONDARY CHART (below) for # Items
      {
        height: 200, // some smaller height
        axisY: {
          title: "# Items",
          titleFontColor: "#29b6f6",
          labelFontColor: "#29b6f6",
          minimum: 0
        },
        data: [
          {
            type: "line",
            name: "# Items",
            color: "#29b6f6",
            lineThickness: 3,
            markerSize: 5,
            showInLegend: true,
            dataPoints: itemsData
          }
        ]
      }
    ],

    // The navigator at the bottom
    navigator: {
      slider: {
        // If your data is 2024 only:
        minimum: new Date(2024, 0, 1),
        maximum: new Date(2024, 11, 31)
      }
    }
  })

  stockChart.render()
})
</script>
