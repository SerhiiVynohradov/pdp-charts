<div class="bg-gray-900 text-white min-h-screen p-6">
  <h1 class="text-2xl font-bold mb-4">My Items</h1>

  <!-- Partial for charts -->
  <%= render partial: "shared/pdp_charts", locals: { chart_data: @chart_data } %>

  <!-- New Item Form -->
  <div class="mb-6">
    <%= render partial: "shared/items/form", locals: { item: Item.new } %>
  </div>

  <!-- Items Table -->
  <table class="min-w-full border-collapse bg-gray-800 text-gray-50">
    <thead>
      <!-- Первая строка заголовков -->
      <tr class="bg-gray-700 border-b border-gray-600">
        <!-- Стандартные столбцы с rowspan=2 -->
        <th class="px-4 py-2 text-left" rowspan="2">Name</th>
        <th class="px-4 py-2 text-left" rowspan="2">Description</th>
        <th class="px-4 py-2 text-left" rowspan="2">Link</th>
        <th class="px-4 py-2 text-left" rowspan="2">Reason</th>
        <th class="px-4 py-2 text-left" rowspan="2">Expected Results</th>
        <th class="px-4 py-2 text-left" rowspan="2">Category</th>
        <th class="px-4 py-2 text-left" rowspan="2">Effort</th>

        <!-- Столбец Progress с динамическим colspan и кнопкой + -->
        <th id="progress_header" class="px-4 py-2 text-left" colspan="<%= @user.item_progress_columns.count %>">
          <div class="flex items-center space-x-2">
            <span>Progress:</span>
            <turbo-frame id="add_progress_column">
              <%= link_to "+", new_my_item_progress_column_path, class: "bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded" %>
            </turbo-frame>
          </div>
        </th>

        <th class="px-4 py-2 text-left" rowspan="2">Result</th>
        <th class="px-4 py-2 text-left" rowspan="2">Certificate Link</th>
        <th class="px-4 py-2 text-left" rowspan="2">Actions</th>
      </tr>

      <!-- Вторая строка заголовков: заголовки для прогресс-колонок -->
      <tr class="bg-gray-700 border-b border-gray-600" id="progress_columns_headers">
        <% @user.item_progress_columns.order(date: :asc).each do |column| %>
          <th id="progress_column_<%= column.id %>" class="px-4 py-2 text-left">
            <div class="flex flex-col space-y-1">
              <%= column.date.strftime("%d %b %Y") %>
              <div class="flex justify-center">
                <%= link_to "Edit", edit_my_item_progress_column_path(column), class: "text-yellow-400 hover:underline", data: { controller: "cell-edit", action: "click->cell-edit#enableEdit", "cell-edit-url-value": edit_my_item_progress_column_path(column), "cell-edit-field-name-value": "date", "cell-edit-initial-value-value": column.date, "cell-edit-resource-name-value": "item_progress_column" } %>
              </div>
            </div>
          </th>
        <% end %>
      </tr>
    </thead>
    <tbody id="items-container">
      <% @items.each do |item| %>
        <%= render partial: "shared/items/item_row", locals: { item: item, progress_columns: @user.item_progress_columns.order(date: :asc) } %>
      <% end %>
    </tbody>
  </table>
</div>
