<%
the_item_path = if @company.present?
                  company_owner_company_team_user_item_path(@company, @team, @user, item)
                elsif @team.present?
                  manager_team_user_item_path(@team, @user, item)
                else
                  my_item_path(item)
                end
%>

<tr id="<%= dom_id(item) %>" class="border-b border-gray-600 hover:bg-gray-700">
  <td class="px-4 py-2 align-top">
    <%= link_to "Details", the_item_path, class: "bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded" %>
  </td>

  <!-- 1) NAME -->
  <td class="px-4 py-2 align-top">
    <div
      class="cursor-pointer"
      data-controller="cell-edit"
      data-action="click->cell-edit#enableEdit"
      data-cell-edit-url-value="<%= the_item_path %>"
      data-cell-edit-field-name-value="name"
      data-cell-edit-initial-value-value="<%= item.name || '' %>"
      data-cell-edit-resource-name-value="item"
    >
      <!-- Display -->
      <span data-cell-edit-target="display">
        <%= item.name.presence || "-" %>
      </span>
      <!-- Inline form (hidden) -->
      <form
        data-cell-edit-target="form"
        class="hidden flex items-center space-x-2 mt-1"
        data-action="submit->cell-edit#submit"
      >
        <input
          type="text"
          class="rounded bg-gray-800 border border-gray-500 px-2 py-1 text-white"
          data-cell-edit-target="input"
        >
        <button
          type="submit"
          class="bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded"
        >
          Save
        </button>
      </form>
    </div>
  </td>

  <!-- 2) DESCRIPTION -->
  <td class="px-4 py-2 align-top">
    <div
      class="cursor-pointer"
      data-controller="cell-edit"
      data-action="click->cell-edit#enableEdit"
      data-cell-edit-url-value="<%= the_item_path %>"
      data-cell-edit-field-name-value="description"
      data-cell-edit-initial-value-value="<%= item.description || '' %>"
      data-cell-edit-resource-name-value="item"
    >
      <span data-cell-edit-target="display">
        <%= item.description.presence || "-" %>
      </span>
      <form
        data-cell-edit-target="form"
        class="hidden flex items-center space-x-2 mt-1"
        data-action="submit->cell-edit#submit"
      >
        <input
          type="text"
          class="rounded bg-gray-800 border border-gray-500 px-2 py-1 text-white w-60"
          data-cell-edit-target="input"
        >
        <button
          type="submit"
          class="bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded"
        >
          Save
        </button>
      </form>
    </div>
  </td>

  <!-- 3) LINK (clickable anchor; if user clicks link, no edit) -->
  <td class="px-4 py-2 align-top">
    <div
      class="cursor-pointer"
      data-controller="cell-edit"
      data-action="click->cell-edit#enableEdit"
      data-cell-edit-url-value="<%= the_item_path %>"
      data-cell-edit-field-name-value="link"
      data-cell-edit-initial-value-value="<%= item.link || '' %>"
      data-cell-edit-resource-name-value="item"
    >
      <span data-cell-edit-target="display">
        <% if item.link.present? %>
          <a href="<%= item.link %>"
             target="_blank"
             class="underline text-blue-400"
             data-cell-edit-target="linkPreventer"  <!-- skip edit if click this -->
          >
            <%= item.link %>
          </a>
        <% else %>
          -
        <% end %>
      </span>
      <form
        data-cell-edit-target="form"
        class="hidden flex items-center space-x-2 mt-1"
        data-action="submit->cell-edit#submit"
      >
        <input
          type="text"
          class="rounded bg-gray-800 border border-gray-500 px-2 py-1 text-white w-64"
          data-cell-edit-target="input"
        >
        <button type="submit"
                class="bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded"
        >
          Save
        </button>
      </form>
    </div>
  </td>

  <!-- 4) REASON -->
  <td class="px-4 py-2 align-top">
    <div
      class="cursor-pointer"
      data-controller="cell-edit"
      data-action="click->cell-edit#enableEdit"
      data-cell-edit-url-value="<%= the_item_path %>"
      data-cell-edit-field-name-value="reason"
      data-cell-edit-initial-value-value="<%= item.reason || '' %>"
      data-cell-edit-resource-name-value="item"
    >
      <span data-cell-edit-target="display">
        <%= item.reason.presence || "-" %>
      </span>
      <form
        data-cell-edit-target="form"
        class="hidden flex items-center space-x-2 mt-1"
        data-action="submit->cell-edit#submit"
      >
        <input
          type="text"
          class="rounded bg-gray-800 border border-gray-500 px-2 py-1 text-white w-60"
          data-cell-edit-target="input"
        >
        <button
          type="submit"
          class="bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded"
        >
          Save
        </button>
      </form>
    </div>
  </td>

  <!-- 5) EXPECTED RESULTS -->
  <td class="px-4 py-2 align-top">
    <div
      class="cursor-pointer"
      data-controller="cell-edit"
      data-action="click->cell-edit#enableEdit"
      data-cell-edit-url-value="<%= the_item_path %>"
      data-cell-edit-field-name-value="expected_results"
      data-cell-edit-initial-value-value="<%= item.expected_results || '' %>"
      data-cell-edit-resource-name-value="item"
    >
      <span data-cell-edit-target="display">
        <%= item.expected_results.presence || "-" %>
      </span>
      <form
        data-cell-edit-target="form"
        class="hidden flex items-center space-x-2 mt-1"
        data-action="submit->cell-edit#submit"
      >
        <input
          type="text"
          class="rounded bg-gray-800 border border-gray-500 px-2 py-1 text-white w-60"
          data-cell-edit-target="input"
        >
        <button
          type="submit"
          class="bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded"
        >
          Save
        </button>
      </form>
    </div>
  </td>

  <!-- 6) CATEGORY -->
  <td class="px-4 py-2 align-top">
    <div
      class="cursor-pointer"
      data-controller="cell-edit"
      data-action="click->cell-edit#enableEdit"
      data-cell-edit-url-value="<%= the_item_path %>"
      data-cell-edit-field-name-value="category"
      data-cell-edit-initial-value-value="<%= item.category || '' %>"
      data-cell-edit-resource-name-value="item"
    >
      <span data-cell-edit-target="display">
        <%= item.category.presence || "-" %>
      </span>
      <form
        data-cell-edit-target="form"
        class="hidden flex items-center space-x-2 mt-1"
        data-action="submit->cell-edit#submit"
      >
        <input
          type="text"
          class="rounded bg-gray-800 border border-gray-500 px-2 py-1 text-white w-60"
          data-cell-edit-target="input"
        >
        <button
          type="submit"
          class="bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded"
        >
          Save
        </button>
      </form>
    </div>
  </td>

  <!-- 7) PROGRESS (number) -->
  <td class="px-4 py-2 align-top">
    <div
      class="cursor-pointer"
      data-controller="cell-edit"
      data-action="click->cell-edit#enableEdit"
      data-cell-edit-url-value="<%= the_item_path %>"
      data-cell-edit-field-name-value="progress"
      data-cell-edit-initial-value-value="<%= item.progress.present? ? item.progress.to_s : '' %>"
      data-cell-edit-resource-name-value="item"
    >
      <span data-cell-edit-target="display">
        <%= item.progress.present? ? "#{item.progress}%" : "-" %>
      </span>
      <form
        data-cell-edit-target="form"
        class="hidden flex items-center space-x-2 mt-1"
        data-action="submit->cell-edit#submit"
      >
        <input
          type="number"
          min="0"
          max="100"
          class="w-16 rounded bg-gray-800 border border-gray-500 px-2 py-1 text-white"
          data-cell-edit-target="input"
        >
        <button
          type="submit"
          class="bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded"
        >
          Save
        </button>
      </form>
    </div>
  </td>

  <!-- 8) EFFORT (select with full-time day descriptions) -->
  <td class="px-4 py-2 align-top">
    <div
      class="cursor-pointer"
      data-controller="cell-edit"
      data-action="click->cell-edit#enableEdit"
      data-cell-edit-url-value="<%= the_item_path %>"
      data-cell-edit-field-name-value="effort"
      data-cell-edit-initial-value-value="<%= item.effort || '' %>"
      data-cell-edit-resource-name-value="item"
    >
      <span data-cell-edit-target="display">
        <%= effort_full_label(item.effort) %>
      </span>
      <form
        data-cell-edit-target="form"
        class="hidden flex items-center space-x-2 mt-1"
        data-action="submit->cell-edit#submit"
      >
        <select data-cell-edit-target="input"
                class="rounded bg-gray-800 border border-gray-500 px-2 py-1 text-white w-72"
        >
          <option value="">Select Effort</option>
          <option value="5">5 - Very Hard (10+ full-time days)</option>
          <option value="4">4 - Hard (5-10 full-time days)</option>
          <option value="3">3 - Medium (3-5 full-time days)</option>
          <option value="2">2 - Easy (2-3 full-time days)</option>
          <option value="1">1 - Very Easy (&lt;1 full-time day)</option>
        </select>
        <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded">
          Save
        </button>
      </form>
    </div>
  </td>

  <!-- 9) RESULT (string) -->
  <td class="px-4 py-2 align-top">
    <div
      class="cursor-pointer"
      data-controller="cell-edit"
      data-action="click->cell-edit#enableEdit"
      data-cell-edit-url-value="<%= the_item_path %>"
      data-cell-edit-field-name-value="result"
      data-cell-edit-initial-value-value="<%= item.result || '' %>"
      data-cell-edit-resource-name-value="item"
    >
      <span data-cell-edit-target="display">
        <%= item.result.presence || "-" %>
      </span>
      <form
        data-cell-edit-target="form"
        class="hidden flex items-center space-x-2 mt-1"
        data-action="submit->cell-edit#submit"
      >
        <input
          type="text"
          class="rounded bg-gray-800 border border-gray-500 px-2 py-1 text-white w-60"
          data-cell-edit-target="input"
        >
        <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded">
          Save
        </button>
      </form>
    </div>
  </td>

  <!-- 10) CERTIFICATE LINK (URL) -->
  <td class="px-4 py-2 align-top">
    <div
      class="cursor-pointer"
      data-controller="cell-edit"
      data-action="click->cell-edit#enableEdit"
      data-cell-edit-url-value="<%= the_item_path %>"
      data-cell-edit-field-name-value="certificate_link"
      data-cell-edit-initial-value-value="<%= item.certificate_link || '' %>"
      data-cell-edit-resource-name-value="item"
    >
      <span data-cell-edit-target="display">
        <% if item.certificate_link.present? %>
          <a href="<%= item.certificate_link %>"
             target="_blank"
             class="underline text-blue-400"
             data-cell-edit-target="linkPreventer"
          >
            <%= item.certificate_link %>
          </a>
        <% else %>
          -
        <% end %>
      </span>
      <form
        data-cell-edit-target="form"
        class="hidden flex items-center space-x-2 mt-1"
        data-action="submit->cell-edit#submit"
      >
        <input
          type="text"
          class="rounded bg-gray-800 border border-gray-500 px-2 py-1 text-white w-60"
          data-cell-edit-target="input"
        >
        <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded">
          Save
        </button>
      </form>
    </div>
  </td>

  <!-- 11) ACTIONS (Delete button) -->
  <td class="px-4 py-2 align-top text-right space-x-2">
    <%= link_to "Delete",
      the_item_path,
      data: { turbo_method: :delete, turbo_confirm: 'Are you sure?' },
      class: "bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded" %>
  </td>
</tr>
